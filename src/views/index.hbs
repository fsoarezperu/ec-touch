<script type="text/javascript">
  var timer_de_display_remote_conection_to_tbm;
  //var remote_TBM = io.connect('http://192.168.1.6:3000');
  var is_connected = false;
  var mydata;
  var mytimer;
  $(document).ready(function() {
    cargar_pantalla_guardada();
    $("#TBM_icon").css('visibility', 'hidden');
    display_remote_conection_to_TBM();
    function enlace_a(a1) {
      var a1x="#"+a1;
      $(document).on("click",a1x,function(){
        console.log("emitting:"+a1);
        socket.emit(a1,a1);
      });
      socket.on(a1, function(msg){
        console.log("receiving:"+a1);
        $('#display').html(msg[1]);
        mydata=msg[0];
        console.log(mydata);
      });
      return;
    }
    function mandar_orden(a2) {
      var a2y="#"+a2;
      $(document).on("click",a2y,function(){
        console.log(a2);
        socket.emit(a2,a2);
      });
      socket.on(a2, function(msg){
        display_message(msg);
      });
      return;
    }
/////////////////////////////////////////////////////////////////////
    enlace_a("main");
/////////////////////////////////////////////////////////////////////
    enlace_a("config");
    enlace_a("info");
    enlace_a("cuadre_diario");
    enlace_a("cifras_generales");
    enlace_a("remesa_hermes");
    enlace_a("Smart_emptying");
    enlace_a("Smart_emptied");
    enlace_a("cashbox_unlocked");
    enlace_a("Cashbox_Back_in_Service");
    enlace_a("iniciar_nueva_remesa");


    mandar_orden("lock_cashbox");
    mandar_orden("unlock_cashbox");
    mandar_orden("smart_empty");
    mandar_orden("Smart_emptying");
    mandar_orden("Smart_emptied");
    mandar_orden("Cashbox_Back_in_Service");
    mandar_orden("cancelar_remesa");
    // mandar_orden("trigger_socket");
    //
     mandar_orden("fer");
    // mandar_orden("connected");

    socket.on('Cashbox_Unlock_Enable', function(msg) {
      console.log("desbloqueado desde aqui.");
    //  window.location.replace("/");
    display_pestillo("Desbloqueado");
    });

    socket.on('iniciando', function(msg) {
      console.log("refrescando pantallas");
      window.location.replace("/");
    });
/////////////////////////////////////////////////////////////////////

    // remote_TBM.on('machine', function(data) {
    //   console.log("ticking...");
    // });
    ////////////////////////////////////////////////////
    socket.on('system_running_indicator', function(msg) {
      display_system_running_indicator();
      online = true;
    });
    function display_system_running_indicator() {
      $("#system_running_indicator").show();
      setTimeout(clear_system_running_indicator, 200);
    };
    function clear_system_running_indicator() {
      $("#system_running_indicator").hide();
    };
    ////////////////////////////////////////////////////
    socket.on('show_connected_to_TBM', function(msg) {
      is_connected = true;
      display_remote_conection_to_TBM();
      clearTimeout(timer_de_display_remote_conection_to_tbm);
      console.log("show_connected_to_TBM");
      clear_conection_to_TBM();
    });
    socket.on('show_not_connected', function(msg) {
      is_connected = false;
    });
    function clear_conection_to_TBM() {
      timer_de_display_remote_conection_to_tbm = setTimeout(function() {
        is_connected = false;
      }, 20000);
    }
    function display_remote_conection_to_TBM() {
      if (is_connected) {
        $("#TBM_icon").css('visibility', 'visible');
      } else {
        $("#TBM_icon").css('visibility', 'hidden');
      }
      setTimeout(function() {
        display_remote_conection_to_TBM();
      }, 10000);
    }
    ////////////////////////////////////////////////////
    function loadFile(filePath) {
      var result = null;
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.open("GET", filePath, false);
      xmlhttp.send();
      if (xmlhttp.status==200) {
        result = xmlhttp.responseText;
      }
      return result;
    }
    function cargar_pantalla_guardada() {
          socket.emit("main","main");
    }
    //////////////////////////////////////////
    function display_message(mes_to_display) {
      document.getElementById("message").innerHTML = mes_to_display;
      setTimeout(clear_message, 1000);
    };
    function clear_message() {
    document.getElementById("message").innerHTML = "";
    document.getElementById("msg1").innerHTML = "Bloqueado";
    };

    function display_pestillo(mes_to_displayx) {
      clearTimeout(mytimer);
      document.getElementById("msg1").innerHTML = mes_to_displayx;
      mytimer=setTimeout(clear_message, 2000);
    };

    //////////////////////////////////////////
  });
</script>


<body oncontextmenu="return false">
  <div id="loading" style="display:none"> <br>Error:<br/>El servidor esta paralizado.</div>
  <div id="display">
    <div class="wrapperx" id="pizarra">
      <!-- ESTO SE LLENA EN LINEA CON LA INFORMACION GUARDADA EN BUFFER.HTML -->
    </div>
  </div>
<!-- <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script> -->
</body>
