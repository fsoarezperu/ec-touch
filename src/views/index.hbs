<script type="text/javascript">
  var timer_de_display_remote_conection_to_tbm;
  var remote_TBM = io.connect('http://192.168.1.2:3000');
  var is_connected = false;
  var mydata;
  $(document).ready(function() {
    cargar_pantalla_guardada();
    $("#TBM_icon").css('visibility', 'hidden');
    display_remote_conection_to_TBM();
/////////////////////////////////////////////////////////////////////
    enlace_a("main");
/////////////////////////////////////////////////////////////////////
    enlace_a("config");
    enlace_a("info");
    enlace_a("cuadre_diario");
    enlace_a("cifras_generales");
    enlace_a("remesa_hermes");

    mandar_orden("lock_cashbox");
    mandar_orden("unlock_cashbox");

/////////////////////////////////////////////////////////////////////
function enlace_a(a1) {
  var a1x="#"+a1;
  $(document).on("click",a1x,function(){
    socket.emit(a1,a1);
  });
  socket.on(a1, function(msg){
    $('#display').html(msg[1]);
    mydata=msg[0];
    console.log(mydata);
  });
  return;
}

function mandar_orden(a2) {
  var a2y="#"+a2;
  $(document).on("click",a2y,function(){
    socket.emit(a2,a2);
  });
  socket.on(a2, function(msg){
    display_message(msg);
  });
  return;
}
    remote_TBM.on('machine', function(data) {
      console.log("ticking...");
    });
    ////////////////////////////////////////////////////
    socket.on('system_running_indicator', function(msg) {
      display_system_running_indicator();
      online = true;
    });
    function display_system_running_indicator() {
      $("#system_running_indicator").show();
      setTimeout(clear_system_running_indicator, 200);
    };
    function clear_system_running_indicator() {
      $("#system_running_indicator").hide();
    };
    ////////////////////////////////////////////////////
    socket.on('show_connected_to_TBM', function(msg) {
      is_connected = true;
      display_remote_conection_to_TBM();
      clearTimeout(timer_de_display_remote_conection_to_tbm);
      console.log("show_connected_to_TBM");
      clear_conection_to_TBM();
    });
    socket.on('show_not_connected', function(msg) {
      is_connected = false;
    });
    function clear_conection_to_TBM() {
      timer_de_display_remote_conection_to_tbm = setTimeout(function() {
        is_connected = false;
      }, 20000);
    }
    function display_remote_conection_to_TBM() {
      if (is_connected) {
        $("#TBM_icon").css('visibility', 'visible');
      } else {
        $("#TBM_icon").css('visibility', 'hidden');
      }
      setTimeout(function() {
        display_remote_conection_to_TBM();
      }, 10000);
    }
    ////////////////////////////////////////////////////
    // $("#LC").click( function(){
    //  socket.emit('lock_cashbox');
    // });
    // $("#UC").click( function(){
    //  socket.emit('unlock_cashbox');
    // });

    // socket.on('lock_cashbox', function(msg){
    //  display_message(msg);
    //  //document.getElementById("msg1").innerHTML="pestillo desbloqueado";
    //  //console.log("pestillo desbloqueado");
    // });
    // socket.on('unlock_cashbox', function(msg){
    //  display_message(msg);
    //  //document.getElementById("msg1").innerHTML="pestillo desbloqueado";
    //  //console.log("pestillo bloqueado");
    // });

    //////////////////////////////////////////
    function loadFile(filePath) {
      var result = null;
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.open("GET", filePath, false);
      xmlhttp.send();
      if (xmlhttp.status==200) {
        result = xmlhttp.responseText;
      }
      return result;
    }
    function cargar_pantalla_guardada() {
        $('#display').load("./buffer.html");
    }
    //////////////////////////////////////////
    function display_message(mes_to_display) {
      document.getElementById("message").innerHTML = mes_to_display;
      setTimeout(clear_message, 1000);
    };
    function clear_message() {
      document.getElementById("message").innerHTML = ""
      document.getElementById("msg1").innerHTML="pestillo bloqueado";
    };
    //////////////////////////////////////////
  });
</script>
<style media="screen">
  /* html, body {
    width  : 100%;
    height : 100%;
  } */
  .wrapper {
    position: relative;
  }

  /* .popup{
    position: relative;
  } */
  .overlay-back {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000000;
    border-radius: 15px;
    opacity: 0.6;
    filter: alpha(opacity=60);
    z-index: 5;
    display: none;
  }

  #overlay {
    position: absolute;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 100%;
    opacity: 1;
    z-index: 10;
    display: none;
    margin: 0 auto;
  }

  #overlay2 {
    position: absolute;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 100%;
    opacity: 1;
    z-index: 10;
    display: none;
    margin: 0 auto;
  }

  #inicializando_sistema {
    position: absolute;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 100%;
    opacity: 1;
    z-index: 10;
    display: none;
    margin: 0 auto;
  }

  #out_of_service {
    position: absolute;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 100%;
    opacity: 1;
    z-index: 10;
    display: none;
    margin: 0 auto;
  }

  .grupo3 {
    /* grid-column: 1/5; */
    min-height: 350px;
    width: 100%;
    max-width: 700px;
    /*grid-row: auto; */
    background-color: rgba(60, 60, 60, 1);
    /* background-image: url("../img/bg_image4.jpg"); */
    color: white;
    border: 4.5px solid white;
    border-radius: 15px;
    padding: 5px;
    text-align: center;
    display: grid;
    grid-template-columns: 0.5fr auto 0.5fr;
    grid-template-rows: 0.5fr 1fr 1fr 0.5fr;
  }
</style>

<body oncontextmenu="return false">
  <div id="loading" style="display:none"> <br>Error:<br/>El servidor esta paralizado.</div>
  <div id="display">
    <div class="wrapper" id="pizarra">
      <!-- ESTO SE LLENA EN LINEA CON LA INFORMACION GUARDADA EN BUFFER.HTML -->
    </div>
  </div>

</body>
